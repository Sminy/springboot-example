## Linux 服务器

### 1. top

<img src="D:\IdeaProjects\springboot-xxx-example\Note\笔记\Linux_top.png" alt="image-20210729171500258" style="zoom:50%;" />

| 内容                           | 含义                                                         |
| :----------------------------- | :----------------------------------------------------------- |
| 05:43:27                       | 表示当前时间                                                 |
| up 4:52                        | 系统运行时间 格式为时：分                                    |
| 2 users                        | 当前登录用户数                                               |
| load average: 0.58, 0.41, 0.30 | 系统负载，即任务队列的平均长度。 三个数值分别为 1分钟、5分钟、15分钟前到现在的平均值。 |

注意: load average: 三个值的平均值/cpu核数，结果高于5的时候就表明系统在超负荷运转了。 

进入top视图后：

- 按数字“1” 键可以监控每个cpu的状况
- 敲击键盘‘b’（打开关闭加亮效果）
- 敲击键盘‘x’（打开/关闭排序列的加亮效果）
-  P 键：以CPU的使用资源排序显示 
- M 键：以内存的使用资源排序显示 
- N 键：以pid排序显示 
- T 键：由进程使用的时间累计排序显示
-  k 键：给某一个pid一个信号。可以用来杀死进程 

### 2. uptime

top  系统性能命令的精简版

```
17:27:36 up 148 days, 23:44,  2 users,  load average: 0.00, 0.01, 0.05
```

### 3. vmstat

```
vmstat -n 2 3
```

**procs**

- r：运行和等待的CPU时间片的进程数，原则上1核的CPU的运行队列不要超过2，整个系统的运行队列不超过总核数的2倍，否则代表系统压力过大，我们看蘑菇博客测试服务器，能发现都超过了2，说明现在压力过大
- b：等待资源的进程数，比如正在等待磁盘I/O、网络I/O等

**cpu**

- us：用户进程消耗CPU时间百分比，us值高，用户进程消耗CPU时间多，如果长期大于50%，优化程序
- sy：内核进程消耗的CPU时间百分比
- us + sy 参考值为80%，如果us + sy 大于80%，说明可能存在CPU不足，从上面的图片可以看出，us + sy还没有超过百分80，因此说明蘑菇博客的CPU消耗不是很高
- id：处于空闲的CPU百分比
- wa：系统等待IO的CPU时间百分比
- st：来自于一个虚拟机偷取的CPU时间比



### 4. pid cpu

1. 服务端安装 sysstat 模块 yum install sysstat
2. ps -ef|grep java
3. pidstat -u 1 -p 进程编号



查看所有cpu核信息：

```
mpstat -P ALL 2
```



### 5.  free

应用程序可用内存数，经验值：

- 应用程序可用内存l系统物理内存>70%内存充足
- 应用程序可用内存/系统物理内存<20%内存不足，需要增加内存
- 20%<应用程序可用内存/系统物理内存<70%内存基本够用

free -h 友好输出：

![image-20210729174821021](D:\IdeaProjects\springboot-xxx-example\Note\笔记\linux_free.png)

下面先解释一下输出的内容：
**Mem** 行(第二行)是内存的使用情况。
**Swap** 行(第三行)是交换空间的使用情况。
**total** 列显示系统总的可用物理内存和交换空间大小。
**used** 列显示已经被使用的物理内存和交换空间。
**free** 列显示还有多少物理内存和交换空间可用使用。
**shared** 列显示被共享使用的物理内存大小。
**buff/cache** 列显示被 buffer 和 cache 使用的物理内存大小。
**available** 列显示还可以被应用程序使用的物理内存大小。